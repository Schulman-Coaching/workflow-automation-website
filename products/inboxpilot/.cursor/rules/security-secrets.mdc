---
description: Security standards for secret management and configuration defaults.
globs: ["**/src/config/configuration.ts", "**/main.ts", "**/.env.example"]
---

# Security and Secret Management Standards

Ensure that the application remains secure across all environments by enforcing strict secret management and fail-fast configurations.

## Rules

- **No Weak Defaults**: DO NOT use weak or hardcoded "change-me" strings as defaults for sensitive configurations (JWT secrets, encryption keys) in non-development environments.
- **Fail-Fast**: The application MUST throw an error during startup if required security-sensitive environment variables are missing in production.
- **Encryption**: Always use strong, authenticated encryption (e.g., `aes-256-gcm`) for sensitive data stored in the database, such as OAuth tokens.
- **Token Storage**: Prefer httpOnly cookies for sensitive session tokens. If using localStorage, strictly limit the token scope and implement rotation.

## Examples

### Correct Configuration
```typescript
const jwtSecret = configService.get<string>('JWT_SECRET');
if (process.env.NODE_ENV === 'production' && !jwtSecret) {
  throw new Error('JWT_SECRET must be defined in production');
}
```

### Incorrect Configuration
```typescript
const jwtSecret = configService.get<string>('JWT_SECRET') || 'dev-secret';
```
